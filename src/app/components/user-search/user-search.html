<div class="user-search-container">
    <div class="search-header">
        <div class="title-group">
            <h1>
                <ng-container *ngIf="isFriendsMode">Mes Amis</ng-container>
                <ng-container *ngIf="!isFriendsMode">Recherche</ng-container>
            </h1>
            <p class="subtitle">
                {{ isFriendsMode ? 'Gérez vos relations et contacts' : 'Découvrez de nouveaux membres' }}
            </p>
        </div>

        <div class="header-actions">
            <!-- Search bar refined -->
            <div class="search-bar-modern">
                <mat-icon>search</mat-icon>
                <input [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()" placeholder="Rechercher..."
                    type="text">
                <button *ngIf="searchQuery" mat-icon-button (click)="searchQuery = ''; onSearchChange()"
                    class="clear-btn">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <!-- Add Friend Action -->
            <button *ngIf="isFriendsMode" mat-flat-button class="invite-btn" (click)="openAddFriendDialog()">
                <mat-icon>person_add</mat-icon>
                <span>Inviter</span>
            </button>
        </div>
    </div>

    <!-- Segmented Tabs for Friends Mode -->
    <div class="tabs-segment-wrapper" *ngIf="isFriendsMode">
        <div class="tabs-segment">
            <button [class.active]="activeTabIndex === 0" (click)="onTabChange(0)">Amis</button>
            <button [class.active]="activeTabIndex === 1" (click)="onTabChange(1)">Invités</button>
            <button [class.active]="activeTabIndex === 2" (click)="onTabChange(2)">Reçus</button>
        </div>
    </div>

    <!-- Content Sections -->
    <div class="results-content">
        <!-- Loading -->
        <div class="loading-state" *ngIf="isLoading">
            <div class="loader-ring"></div>
            <p>Chargement...</p>
        </div>

        <!-- Error -->
        <div class="error-state" *ngIf="error && !isLoading">
            <mat-icon>error_outline</mat-icon>
            <p>{{ error }}</p>
            <button mat-flat-button (click)="loadUsers()">Réessayer</button>
        </div>

        <!-- Grid -->
        <div class="grid-wrapper" *ngIf="!isLoading && !error">
            <div class="users-grid" *ngIf="filteredUsers.length > 0">
                <app-user-card *ngFor="let user of filteredUsers; let i = index" [user]="user"
                    [showFriendBadge]="!isFriendsMode" [style.animation-delay]="(i * 0.05) + 's'"
                    (addFriend)="onAddFriend($event)" (acceptFriend)="onAcceptFriend($event)"
                    (declineFriend)="onDeclineFriend($event)" (removeFriend)="onRemoveFriend($event)"
                    (chat)="onChat($event)">
                </app-user-card>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="filteredUsers.length === 0">
                <div class="empty-icon">
                    <mat-icon>person_search</mat-icon>
                </div>
                <h3>Aucun résultat</h3>
                <p>Nous n'avons trouvé aucun utilisateur correspondant à votre recherche.</p>
                <button mat-stroked-button (click)="searchQuery = ''; onSearchChange()">Voir tout</button>
            </div>
        </div>
    </div>
</div>