<div class="calendar-container" [class.split-view]="selectedDate && viewMode === 'month'"
    [class.week-mode]="viewMode === 'week'" [class.day-mode]="viewMode === 'day'">

    <!-- Calendar Section -->
    <div class="calendar-section">
        <div class="calendar-header">
            <div class="title-group">
                <h2 class="current-month">
                    <ng-container *ngIf="viewMode === 'month'">{{ currentDate | date: 'MMMM yyyy' }}</ng-container>
                    <ng-container *ngIf="viewMode === 'week'">Semaine {{ getWeekNumber(currentDate) }}, {{ currentDate |
                        date: 'yyyy' }}</ng-container>
                    <ng-container *ngIf="viewMode === 'day'">{{ currentDate | date: 'MMM d, yyyy' }}</ng-container>
                </h2>
            </div>

            <div class="header-controls">
                <div class="view-toggle">
                    <button [class.active]="viewMode === 'month'" (click)="toggleView('month')">Month</button>
                    <button [class.active]="viewMode === 'week'" (click)="toggleView('week')">Week</button>
                    <button [class.active]="viewMode === 'day'" (click)="toggleView('day')">Day</button>
                </div>

                <div class="nav-buttons">
                    <button (click)="navigate(-1)" aria-label="Previous">
                        <mat-icon>chevron_left</mat-icon>
                    </button>
                    <button (click)="navigate(1)" aria-label="Next">
                        <mat-icon>chevron_right</mat-icon>
                    </button>
                </div>
            </div>
        </div>

        <!-- Month View Layout -->
        <ng-container *ngIf="viewMode === 'month'">
            <div class="weekdays">
                <div *ngFor="let day of weekDays" class="weekday-name">{{ day }}</div>
            </div>

            <div class="days-grid month-grid" [class.selection-active]="selectedDate">
                <div *ngFor="let day of days; let i = index" class="day-cell" [class.other-month]="!day.isCurrentMonth"
                    [class.today]="day.isToday" [class.selected]="selectedDate && isSameDate(day.date, selectedDate)"
                    (click)="selectDate(day)">

                    <div class="day-content">
                        <span class="day-number">{{ day.date | date:'d' }}</span>
                        <div class="event-dots" *ngIf="day.hasEvents">
                            <span class="dot"></span>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <!-- Week/Day View Layout (Apple Style Schedule) -->
        <ng-container *ngIf="viewMode === 'week' || viewMode === 'day'">
            <div class="week-schedule-container" [class.day-mode]="viewMode === 'day'">
                <!-- Time Axis -->
                <div class="time-axis">
                    <div class="axis-header"></div>
                    <div *ngFor="let hour of hours" class="hour-slot">
                        {{ hour | number:'2.0' }}:00
                    </div>
                </div>

                <!-- Day Columns -->
                <div class="day-columns">
                    <div *ngFor="let day of days" class="day-column" [class.today]="day.isToday">
                        <div class="column-header">
                            <span class="day-label">{{ day.date | date:'EEE' }}</span>
                            <span class="date-label">{{ day.date | date:'d' }}</span>
                        </div>
                        <div class="hour-slots">
                            <!-- Timeline Indicator -->
                            <div class="timeline-indicator" [class.vivid]="isToday(day.date)"
                                [style.top.%]="currentTimePosition">
                                <div class="dot" *ngIf="isToday(day.date)"></div>
                                <div class="line"></div>
                            </div>

                            <div *ngFor="let hour of hours" class="hour-cell">
                                <div class="event-container">
                                    <div *ngFor="let event of getEventsForHour(day.date, hour)"
                                        class="inline-event-card" [style.top.%]="getEventMinuteOffset(event)"
                                        (click)="viewEventDetails(event)">
                                        <div class="event-accent"></div>
                                        <span class="event-title">{{ event.title }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>

    <!-- Details Section (Month View Only) -->
    <div class="details-section" [class.visible]="selectedDate && viewMode === 'month'">
        <div class="details-header">
            <h3>{{ selectedDate | date:'EEEE, d MMMM yyyy' }}</h3>
            <button (click)="selectedDate = null">
                <mat-icon>close</mat-icon>
            </button>
        </div>

        <div class="events-list">
            <div *ngIf="selectedEvents.length === 0" class="no-events">
                <p>Aucun événement pour ce jour</p>
                <button>Ajouter un événement</button>
            </div>

            <div *ngFor="let event of selectedEvents" class="event-card">
                <div class="event-accent"></div>
                <div class="event-time">{{ event.time }}</div>
                <div class="event-info">
                    <h4>{{ event.title }}</h4>
                    <p>{{ event.description }}</p>
                </div>
                <mat-icon class="arrow-icon">chevron_right</mat-icon>
            </div>
        </div>
    </div>
</div>